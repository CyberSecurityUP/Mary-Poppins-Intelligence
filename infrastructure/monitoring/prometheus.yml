# Mary Poppins â€” Prometheus Configuration

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  scrape_timeout: 10s

rule_files:
  - "alerts/*.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

scrape_configs:
  # Core API metrics
  - job_name: "core-api"
    metrics_path: /metrics
    static_configs:
      - targets: ["core-api:8000"]
        labels:
          service: core-api
          component: backend

  # Worker metrics (Celery/Flower)
  - job_name: "celery-workers"
    static_configs:
      - targets:
          - "ingestion-worker:5555"
          - "classifier-worker:5555"
          - "osint-worker:5555"
          - "crypto-worker:5555"
          - "darkweb-crawler:5555"
        labels:
          component: worker

  # PostgreSQL
  - job_name: "postgresql"
    static_configs:
      - targets: ["postgres-exporter:9187"]
        labels:
          service: postgresql
          component: database

  # Neo4j
  - job_name: "neo4j"
    metrics_path: /metrics
    static_configs:
      - targets: ["neo4j:2004"]
        labels:
          service: neo4j
          component: database

  # Elasticsearch
  - job_name: "elasticsearch"
    static_configs:
      - targets: ["es-exporter:9114"]
        labels:
          service: elasticsearch
          component: database

  # Redis
  - job_name: "redis"
    static_configs:
      - targets: ["redis-exporter:9121"]
        labels:
          service: redis
          component: cache

  # Kafka
  - job_name: "kafka"
    static_configs:
      - targets: ["kafka-exporter:9308"]
        labels:
          service: kafka
          component: messaging

  # Kong API Gateway
  - job_name: "kong"
    static_configs:
      - targets: ["api-gateway:8001"]
        labels:
          service: kong
          component: gateway

  # Node metrics
  - job_name: "node"
    static_configs:
      - targets: ["node-exporter:9100"]
        labels:
          component: infrastructure
